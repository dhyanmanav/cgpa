<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PWA Test - CGPA Planner</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f0f0f0;
    }
    .test-item {
      background: white;
      padding: 15px;
      margin: 10px 0;
      border-radius: 8px;
      border-left: 4px solid #ddd;
    }
    .test-item.pass {
      border-left-color: #4caf50;
    }
    .test-item.fail {
      border-left-color: #f44336;
    }
    button {
      background: #4caf50;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background: #45a049;
    }
    pre {
      background: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>üîß PWA Test Page</h1>
  <p>This page helps diagnose PWA installation issues.</p>
  
  <div id="results"></div>
  
  <button onclick="runTests()">Run Tests</button>
  <button onclick="location.href='/'">Go to App</button>
  
  <script>
    async function runTests() {
      const results = document.getElementById('results');
      results.innerHTML = '';
      
      const tests = [
        {
          name: 'Service Worker Support',
          test: () => 'serviceWorker' in navigator,
          description: 'Browser supports service workers'
        },
        {
          name: 'Manifest Link',
          test: async () => {
            const link = document.querySelector('link[rel="manifest"]');
            if (!link) return false;
            try {
              const response = await fetch(link.href);
              return response.ok;
            } catch {
              return false;
            }
          },
          description: 'Manifest file is accessible'
        },
        {
          name: 'Service Worker Registration',
          test: async () => {
            try {
              const registration = await navigator.serviceWorker.getRegistration('/');
              return !!registration;
            } catch {
              return false;
            }
          },
          description: 'Service worker is registered'
        },
        {
          name: 'HTTPS or Localhost',
          test: () => location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1',
          description: 'Running on HTTPS or localhost (required for PWA)'
        },
        {
          name: 'Install Prompt Available',
          test: () => {
            return new Promise((resolve) => {
              let hasPrompt = false;
              const handler = (e) => {
                hasPrompt = true;
                window.removeEventListener('beforeinstallprompt', handler);
                resolve(true);
              };
              window.addEventListener('beforeinstallprompt', handler);
              setTimeout(() => {
                window.removeEventListener('beforeinstallprompt', handler);
                resolve(hasPrompt);
              }, 1000);
            });
          },
          description: 'Browser shows install prompt'
        }
      ];
      
      for (const test of tests) {
        const div = document.createElement('div');
        div.className = 'test-item';
        div.innerHTML = `<strong>${test.name}</strong><br>${test.description}<br><em>Testing...</em>`;
        results.appendChild(div);
        
        try {
          const passed = await test.test();
          div.className = `test-item ${passed ? 'pass' : 'fail'}`;
          div.innerHTML = `<strong>${test.name}</strong><br>${test.description}<br>Result: ${passed ? '‚úÖ PASS' : '‚ùå FAIL'}`;
        } catch (error) {
          div.className = 'test-item fail';
          div.innerHTML = `<strong>${test.name}</strong><br>${test.description}<br>Result: ‚ùå ERROR<br><pre>${error.message}</pre>`;
        }
      }
      
      // Additional info
      const info = document.createElement('div');
      info.className = 'test-item';
      info.innerHTML = `
        <strong>Additional Information</strong><br>
        <pre>
Protocol: ${location.protocol}
Hostname: ${location.hostname}
User Agent: ${navigator.userAgent}
Display Mode: ${window.matchMedia('(display-mode: standalone)').matches ? 'Standalone' : 'Browser'}
        </pre>
      `;
      results.appendChild(info);
    }
    
    // Auto-run on load
    window.addEventListener('load', runTests);
  </script>
</body>
</html>
